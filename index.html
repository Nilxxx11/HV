<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Mi espacio digital</title>
  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
  <!-- Bootstrap Icons -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet" />
  <style>
    :root {
      --bg: #0f1220;
      --card: #151936;
      --muted: #9aa3b2;
      --brand: #6ea8fe;
      --brand-2: #b197fc;
      --text: #f5f7fb;
      --ok: #51cf66;
      --warn: #fcc419;
      --danger: #ff6b6b;
    }
    html, body { background: var(--bg); color: var(--text); }
    a { color: var(--brand); }
    .navbar { background: rgba(10,12,24,0.8) !important; backdrop-filter: blur(8px); }
    .navbar .nav-link { color: #e6e9f1 !important; }
    .hero {
      background: radial-gradient(1200px 400px at 10% 10%, rgba(110,168,254,0.15) 0%, rgba(0,0,0,0) 40%),
                  radial-gradient(1000px 500px at 90% 20%, rgba(177,151,252,0.12) 0%, rgba(0,0,0,0) 45%);
      padding: 6rem 0 4rem 0;
    }
    .card {
      background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.00));
      border: 1px solid rgba(255,255,255,0.08);
      border-radius: 1rem;
      box-shadow: 0 10px 30px rgba(0,0,0,0.25);
      color: var(--text);
    }
    .card-header { border-bottom: 1px solid rgba(255,255,255,0.08); }
    .badge-soft {
      background: rgba(110,168,254,0.1);
      color: #dbe7ff;
      border: 1px solid rgba(110,168,254,0.25);
    }
    .section-title {
      font-weight: 700;
      letter-spacing: .5px;
    }
    .muted { color: var(--muted); }
    .rounded-xxl { border-radius: 1.5rem; }
    .shadow-soft { box-shadow: 0 6px 22px rgba(0,0,0,0.25); }
    .form-control, .form-select { background: #0f1329; border: 1px solid #2b2f4a; color: #e7ecff; }
    .form-control:focus, .form-select:focus { border-color: var(--brand); box-shadow: 0 0 0 .2rem rgba(110,168,254,0.25); }
    .btn-primary { background: linear-gradient(90deg, var(--brand), var(--brand-2)); border: 0; }
    .btn-outline-light { border-color: rgba(255,255,255,0.3); }
    .table { color: #e7ecff; }
    .table thead { color: #b9c3d9; }
    .divider {
      height: 1px;
      background: linear-gradient(90deg, rgba(255,255,255,0), rgba(255,255,255,0.25), rgba(255,255,255,0));
      margin: 2rem 0;
    }
    .avatar {
      width: 240px; height: 240px;
      border-radius: 100%;
      object-fit: cover;
      border: 3px solid rgba(255,255,255,0.25);
      box-shadow: 0 8px 20px rgba(0,0,0,0.4);
    }
    .sticky-admin {
      position: fixed;
      bottom: 1rem; right: 1rem;
      z-index: 1040;
    }
    .nav-pills .nav-link.active { background: linear-gradient(90deg, var(--brand), var(--brand-2)); }
    .small-note { font-size: .85rem; color: var(--muted); }
    footer { border-top: 1px solid rgba(255,255,255,0.08); }
    .cursor-pointer { cursor: pointer; }
    .alert-slim { padding: .5rem .75rem; border-radius: .75rem; }
    .toast-container { z-index: 1050; }
    .loading { opacity: 0.7; pointer-events: none; }
    @media (max-width: 768px) {
      .hero { padding: 5rem 0 3rem 0; }
      .avatar { width: 100px; height: 100px; }
      .offcanvas-end { width: 100% !important; }
    }
  </style>
</head>
<body>
  <!-- Toast para notificaciones -->
  <div class="toast-container position-fixed top-0 end-0 p-3">
    <div id="liveToast" class="toast align-items-center text-white bg-success border-0" role="alert" aria-live="assertive" aria-atomic="true">
      <div class="d-flex">
        <div class="toast-body" id="toastMessage"></div>
        <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast" aria-label="Close"></button>
      </div>
    </div>
  </div>

  <!-- NAVBAR -->
  <nav class="navbar navbar-expand-lg navbar-dark py-3 fixed-top">
    <div class="container">
      <a class="navbar-brand fw-bold" href="#">💻Mi espacio digital📟</a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navMain">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div id="navMain" class="collapse navbar-collapse">
        <ul class="navbar-nav ms-auto">
          <li class="nav-item"><a class="nav-link" href="#inicio">Inicio</a></li>
          <li class="nav-item"><a class="nav-link" href="#sobre-mi">Sobre mí</a></li>
          <li class="nav-item"><a class="nav-link" href="#habilidades">Habilidades</a></li>
          <li class="nav-item"><a class="nav-link" href="#experiencia">Experiencia</a></li>
          <li class="nav-item"><a class="nav-link" href="#educacion">Educación</a></li>
          <li class="nav-item"><a class="nav-link" href="#certificados">Certificados</a></li>
          <li class="nav-item"><a class="nav-link" href="#contacto">Contacto</a></li>
          <li class="nav-item"><a class="nav-link" href="#docs">Docs</a></li>
        </ul>
      </div>
    </div>
  </nav>

  <!-- HERO / INICIO -->
  <header id="inicio" class="hero">
    <div class="container">
      <div class="row align-items-center g-4">
        <div class="col-md-3 text-center">
          <img id="avatarImg" src="https://raw.githubusercontent.com/username/repo/branch/images/perfil.jpg" alt="Foto de perfil" class="avatar">
        </div>
        <div class="col-md-9">
          <h1 id="nombre" class="display-5 fw-bold">Tu Nombre</h1>
          <p id="titulo" class="lead">Tu Título Profesional</p>
          <p id="descripcion" class="mb-3 muted">Breve descripción profesional. Esta información se edita desde el panel de administración y se guarda en Firebase.</p>
          <div class="d-flex gap-3 align-items-center flex-wrap">
            <a id="linkedinLink" class="btn btn-outline-light btn-sm" target="_blank" href="#"><i class="bi bi-linkedin me-1"></i> LinkedIn</a>
            <a id="githubLink" class="btn btn-outline-light btn-sm" target="_blank" href="#"><i class="bi bi-github me-1"></i> GitHub</a>
            <a id="twitterLink" class="btn btn-outline-light btn-sm" target="_blank" href="#"><i class="bi bi-twitter-x me-1"></i> X/Twitter</a>
            <a id="cvLink" class="btn btn-outline-light btn-sm" target="_blank" href="#"><i class="bi bi-file-earmark-person me-1"></i> CV</a>
          </div>
        </div>
      </div>
    </div>
  </header>

  <!-- SOBRE MI -->
  <section id="sobre-mi" class="py-5">
    <div class="container">
      <h2 class="section-title mb-4">Sobre mí</h2>
      <div class="row g-4">
        <div class="col-md-8">
          <div class="card p-4">
            <h5 class="mb-3">Resumen</h5>
            <p id="sobreMiText" class="mb-0">Aquí puedes ampliar tu historia, fortalezas y objetivos. Edita este texto en el panel de administración.</p>
          </div>
        </div>
        <div class="col-md-4">
          <div class="card p-4">
            <h5 class="mb-3">Datos de contacto</h5>
            <ul class="list-unstyled mb-0">
              <li><i class="bi bi-envelope me-2"></i><span id="emailText">correo@ejemplo.com</span></li>
              <li><i class="bi bi-telephone me-2"></i><span id="telefonoText">+57 300 000 0000</span></li>
              <li><i class="bi bi-geo-alt me-2"></i><span id="ubicacionText">Colombia</span></li>
            </ul>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- HABILIDADES -->
  <section id="habilidades" class="py-5">
    <div class="container">
      <h2 class="section-title mb-4">Habilidades</h2>
      <div class="row g-4">
        <div class="col-md-6">
          <div class="card p-4">
            <h5 class="mb-3">Técnicas</h5>
            <div id="listTech" class="d-flex flex-wrap gap-2"></div>
          </div>
        </div>
        <div class="col-md-6">
          <div class="card p-4">
            <h5 class="mb-3">Profesionales</h5>
            <div id="listSoft" class="d-flex flex-wrap gap-2"></div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- EXPERIENCIA -->
  <section id="experiencia" class="py-5">
    <div class="container">
      <h2 class="section-title mb-4">Experiencia</h2>
      <div id="experienciaList" class="row g-4"></div>
    </div>
  </section>

  <!-- EDUCACIÓN -->
  <section id="educacion" class="py-5">
    <div class="container">
      <h2 class="section-title mb-4">Educación</h2>
      <div id="educacionList" class="row g-4"></div>
    </div>
  </section>

  <!-- CERTIFICADOS -->
  <section id="certificados" class="py-5">
    <div class="container">
      <h2 class="section-title mb-4">Certificados</h2>
      <div id="certificadosList" class="row g-4"></div>
    </div>
  </section>

  <!-- CONTACTO -->
  <section id="contacto" class="py-5">
    <div class="container">
      <h2 class="section-title mb-4">Contacto</h2>
      <div class="card p-4">
        <p class="mb-1">Email: <a id="emailLink" href="neil.pereira.robles@gmail.com">neil.pereira.robles@gmail.com</a></p>
        <p class="mb-0">También puedes escribirme por LinkedIn desde los botones arriba.</p>
      </div>
    </div>
  </section>

  <!-- DOCUMENTACIÓN / INSTRUCCIONES
  <section id="docs" class="py-5">
    <div class="container">
      <h2 class="section-title mb-3">Instrucciones de implementación</h2>
      <div class="card p-4">
        <ol class="mb-0">
          <li class="mb-3">
            <strong>Crear proyecto Firebase (Realtime Database)</strong><br/>
            1) Entra a <em>console.firebase.google.com</em> &rarr; Crea un proyecto.<br/>
            2) Agrega una app Web &rarr; copia las credenciales de configuración.<br/>
            3) En <em>Build &rarr; Realtime Database</em>, crea la base de datos en modo bloqueado y agrega Reglas que permitan lectura para todos (público) y escritura solo para admin si prefieres. Para pruebas, puedes usar temporalmente:<br/>
            <pre class="bg-dark text-light p-2 rounded-xxl small">{
  "rules": {
    ".read": true,
    ".write": true
  }
}</pre>
            Luego <em>restringe</em> las reglas según tus necesidades.
          </li>
          <li class="mb-3">
            <strong>Configurar el archivo</strong><br/>
            - En el bloque <code>// TODO: Pega aquí tu config de Firebase</code> reemplaza los valores por tu configuración.<br/>
            - Sube <code>index.html</code> a tu repositorio.
          </li>
          <li class="mb-3">
            <strong>Subir imágenes a GitHub</strong><br/>
            - Crea carpetas en tu repo: <code>/images/perfil.jpg</code>, <code>/images/certificados/certificado1.jpg</code>, etc.<br/>
            - Usa la URL cruda (raw) o la ruta pública de GitHub Pages. Ejemplo crudo:<br/>
            <code>https://raw.githubusercontent.com/&lt;usuario&gt;/&lt;repo&gt;/&lt;rama&gt;/images/perfil.jpg</code><br/>
            - Copia esa URL en el panel de admin donde corresponda.
          </li>
          <li class="mb-3">
            <strong>Desplegar en GitHub Pages</strong><br/>
            - Activa GitHub Pages en tu repo (Settings &rarr; Pages &rarr; Branch: <em>main</em> /root).<br/>
            - Accede a la URL que genera GitHub.
          </li>
          <li class="mb-3">
            <strong>Desplegar en Netlify</strong><br/>
            - Arrastra y suelta el <code>index.html</code> en <em>app.netlify.com/drop</em> o conecta tu repo.<br/>
            - Listo. Netlify publicará un dominio *.netlify.app.
          </li>
          <li class="mb-0">
            <strong>Seguridad</strong><br/>
            - Este demo usa <em>login de cliente</em> con credenciales fijas (inseguro para producción). No guardes secretos reales.<br/>
            - Protege la escritura en la DB con reglas y considera un backend real si necesitas seguridad fuerte.
          </li>
        </ol>
      </div>
    </div>
  </section> -->

  <footer class="py-4">
    <div class="container d-flex justify-content-between">
      <small class="muted">© <span id="year"></span> NeilP.</small>
      <small class="muted">-</small>
    </div>
  </footer>

  <!-- BOTÓN ADMIN -->
  <button class="btn btn-primary sticky-admin" data-bs-toggle="offcanvas" data-bs-target="#adminPanel">
    <i class="bi bi-gear-wide-connected me-1"></i> Admin
  </button>

  <!-- PANEL ADMIN (Offcanvas) -->
  <div class="offcanvas offcanvas-end text-bg-dark" tabindex="-1" id="adminPanel" style="width: 420px;">
    <div class="offcanvas-header">
      <h5 class="offcanvas-title">Panel de administración</h5>
      <button type="button" class="btn-close btn-close-white" data-bs-dismiss="offcanvas"></button>
    </div>
    <div class="offcanvas-body small">
      <!-- Login -->
      <div id="loginBox" class="card p-3 mb-3">
        <div class="d-flex justify-content-between align-items-center mb-2">
          <strong>Acceso</strong>
          <span class="small-note">usuario: <code>/code>, pass: <code></code></span>
        </div>
        <div class="mb-2">
          <label class="form-label">Usuario</label>
          <input id="loginUser" class="form-control form-control-sm">
        </div>
        <div class="mb-3">
          <label class="form-label">Contraseña</label>
          <input id="loginPass" type="password" class="form-control form-control-sm">
        </div>
        <div class="d-grid">
          <button id="btnLogin" class="btn btn-primary btn-sm">Entrar</button>
        </div>
      </div>

      <div id="adminContent" class="d-none">
        <!-- Aviso sesión -->
        <div class="alert alert-slim alert-info mb-3">
          <i class="bi bi-person-check me-1"></i> Sesión iniciada como <strong>admin</strong>.
          <button id="btnLogout" class="btn btn-sm btn-outline-light float-end">Salir</button>
        </div>

        <!-- Tabs -->
        <ul class="nav nav-pills mb-3" id="pills-tab" role="tablist">
          <li class="nav-item" role="presentation">
            <button class="nav-link active" id="tab-personal" data-bs-toggle="pill" data-bs-target="#panel-personal" type="button">Personal</button>
          </li>
          <li class="nav-item" role="presentation">
            <button class="nav-link" id="tab-habilidades" data-bs-toggle="pill" data-bs-target="#panel-habilidades" type="button">Habilidades</button>
          </li>
          <li class="nav-item" role="presentation">
            <button class="nav-link" id="tab-exp" data-bs-toggle="pill" data-bs-target="#panel-exp" type="button">Experiencia</button>
          </li>
          <li class="nav-item" role="presentation">
            <button class="nav-link" id="tab-edu" data-bs-toggle="pill" data-bs-target="#panel-edu" type="button">Educación</button>
          </li>
          <li class="nav-item" role="presentation">
            <button class="nav-link" id="tab-cert" data-bs-toggle="pill" data-bs-target="#panel-cert" type="button">Certificados</button>
          </li>
        </ul>

        <div class="tab-content">
          <!-- PERSONAL -->
          <div class="tab-pane fade show active" id="panel-personal">
            <div class="card p-3 mb-3">
              <h6 class="mb-3">Información personal</h6>
              <div class="row g-2">
                <div class="col-12">
                  <label class="form-label">URL foto de perfil (GitHub)</label>
                  <input id="inpFoto" class="form-control form-control-sm" placeholder="https://raw.githubusercontent.com/usuario/repo/rama/images/perfil.jpg">
                </div>
                <div class="col-12">
                  <label class="form-label">Nombre</label>
                  <input id="inpNombre" class="form-control form-control-sm">
                </div>
                <div class="col-12">
                  <label class="form-label">Título</label>
                  <input id="inpTitulo" class="form-control form-control-sm">
                </div>
                <div class="col-12">
                  <label class="form-label">Descripción / Sobre mí</label>
                  <textarea id="inpDesc" class="form-control form-control-sm" rows="3"></textarea>
                </div>
                <div class="col-12 col-md-6">
                  <label class="form-label">Email</label>
                  <input id="inpEmail" class="form-control form-control-sm">
                </div>
                <div class="col-12 col-md-6">
                  <label class="form-label">Teléfono</label>
                  <input id="inpTel" class="form-control form-control-sm">
                </div>
                <div class="col-12">
                  <label class="form-label">Ubicación</label>
                  <input id="inpUbic" class="form-control form-control-sm">
                </div>
                <div class="col-12 col-md-6">
                  <label class="form-label">LinkedIn URL</label>
                  <input id="inpLinkedin" class="form-control form-control-sm">
                </div>
                <div class="col-12 col-md-6">
                  <label class="form-label">GitHub URL</label>
                  <input id="inpGithub" class="form-control form-control-sm">
                </div>
                <div class="col-12 col-md-6">
                  <label class="form-label">X/Twitter URL</label>
                  <input id="inpTwitter" class="form-control form-control-sm">
                </div>
                <div class="col-12 col-md-6">
                  <label class="form-label">CV URL (opcional)</label>
                  <input id="inpCv" class="form-control form-control-sm">
                </div>
              </div>
              <div class="d-flex gap-2 mt-3">
                <button id="btnPreviewPersonal" class="btn btn-outline-light btn-sm">Previsualizar</button>
                <button id="btnSavePersonal" class="btn btn-primary btn-sm">Guardar</button>
              </div>
            </div>
          </div>

          <!-- HABILIDADES -->
          <div class="tab-pane fade" id="panel-habilidades">
            <div class="card p-3 mb-3">
              <h6 class="mb-3">Agregar habilidad</h6>
              <div class="row g-2">
                <div class="col-8">
                  <input id="inpHabNombre" class="form-control form-control-sm" placeholder="Ej: JavaScript / Comunicación">
                </div>
                <div class="col-4">
                  <select id="inpHabTipo" class="form-select form-select-sm">
                    <option value="tech">Técnica</option>
                    <option value="soft">Profesional</option>
                  </select>
                </div>
                <div class="col-12">
                  <label class="form-label">Nivel (0-100)</label>
                  <input id="inpHabNivel" type="number" min="0" max="100" class="form-control form-control-sm" value="70">
                </div>
              </div>
              <div class="d-flex gap-2 mt-3">
                <button id="btnAddHab" class="btn btn-primary btn-sm">Agregar</button>
              </div>
            </div>
            <div class="card p-3">
              <h6 class="mb-3">Listado de habilidades</h6>
              <table class="table table-sm align-middle mb-0">
                <thead><tr><th>Nombre</th><th>Tipo</th><th>Nivel</th><th></th></tr></thead>
                <tbody id="tableHabs"></tbody>
              </table>
            </div>
          </div>

          <!-- EXPERIENCIA -->
          <div class="tab-pane fade" id="panel-exp">
            <div class="card p-3 mb-3">
              <h6 class="mb-3">Agregar experiencia</h6>
              <div class="row g-2">
                <div class="col-12"><input id="inpExpEmpresa" class="form-control form-control-sm" placeholder="Empresa"></div>
                <div class="col-12"><input id="inpExpPuesto" class="form-control form-control-sm" placeholder="Puesto"></div>
                <div class="col-6"><input id="inpExpIni" class="form-control form-control-sm" placeholder="Fecha inicio (Ene 2023)"></div>
                <div class="col-6"><input id="inpExpFin" class="form-control form-control-sm" placeholder="Fecha fin (Actual)"></div>
                <div class="col-12"><textarea id="inpExpDesc" class="form-control form-control-sm" rows="3" placeholder="Descripción / logros"></textarea></div>
              </div>
              <div class="d-flex gap-2 mt-3">
                <button id="btnAddExp" class="btn btn-primary btn-sm">Agregar</button>
              </div>
            </div>
            <div class="card p-3">
              <h6 class="mb-3">Experiencias guardadas</h6>
              <table class="table table-sm align-middle mb-0">
                <thead><tr><th>Empresa</th><th>Puesto</th><th>Fechas</th><th></th></tr></thead>
                <tbody id="tableExp"></tbody>
              </table>
            </div>
          </div>

          <!-- EDUCACIÓN -->
          <div class="tab-pane fade" id="panel-edu">
            <div class="card p-3 mb-3">
              <h6 class="mb-3">Agregar formación</h6>
              <div class="row g-2">
                <div class="col-12"><input id="inpEduInst" class="form-control form-control-sm" placeholder="Institución"></div>
                <div class="col-12"><input id="inpEduTitulo" class="form-control form-control-sm" placeholder="Título / Programa"></div>
                <div class="col-12"><input id="inpEduFecha" class="form-control form-control-sm" placeholder="Fecha (2020 - 2024)"></div>
              </div>
              <div class="d-flex gap-2 mt-3">
                <button id="btnAddEdu" class="btn btn-primary btn-sm">Agregar</button>
              </div>
            </div>
            <div class="card p-3">
              <h6 class="mb-3">Formación guardada</h6>
              <table class="table table-sm align-middle mb-0">
                <thead><tr><th>Institución</th><th>Título</th><th>Fecha</th><th></th></tr></thead>
                <tbody id="tableEdu"></tbody>
              </table>
            </div>
          </div>

          <!-- CERTIFICADOS -->
          <div class="tab-pane fade" id="panel-cert">
            <div class="card p-3 mb-3">
              <h6 class="mb-3">Agregar certificado</h6>
              <div class="row g-2">
                <div class="col-12"><input id="inpCertNombre" class="form-control form-control-sm" placeholder="Nombre del certificado"></div>
                <div class="col-12"><input id="inpCertInst" class="form-control form-control-sm" placeholder="Institución"></div>
                <div class="col-12"><input id="inpCertFecha" class="form-control form-control-sm" placeholder="Fecha"></div>
                <div class="col-12"><input id="inpCertImg" class="form-control form-control-sm" placeholder="URL imagen (GitHub)"></div>
              </div>
              <div class="d-flex gap-2 mt-3">
                <button id="btnPreviewCert" class="btn btn-outline-light btn-sm">Previsualizar</button>
                <button id="btnAddCert" class="btn btn-primary btn-sm">Agregar</button>
              </div>
              <div id="certPreview" class="mt-3 d-none">
                <div class="card p-2">
                  <div class="row g-2 align-items-center">
                    <div class="col-4"><img id="certPrevImg" class="img-fluid rounded" alt="preview"></div>
                    <div class="col-8">
                      <div class="fw-bold" id="certPrevNombre"></div>
                      <div class="muted" id="certPrevInst"></div>
                      <div class="small" id="certPrevFecha"></div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <div class="card p-3">
              <h6 class="mb-3">Certificados guardados</h6>
              <table class="table table-sm align-middle mb-0">
                <thead><tr><th>Nombre</th><th>Institución</th><th>Fecha</th><th></th></tr></thead>
                <tbody id="tableCert"></tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Bootstrap JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

  <!-- Firebase (Compat SDK) -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

  <!-- LÓGICA JS -->
  <script>
    // ================== CONFIGURACIÓN FIREBASE ==================
    // TODO: Pega aquí tu config de Firebase (App Web) desde la consola de Firebase
    const firebaseConfig = {
  apiKey: "AIzaSyBRj_XERD1UGa8RhKG5CZ589yr21D0w37w",
  authDomain: "adicionales-3d645.firebaseapp.com",
  databaseURL: "https://adicionales-3d645-default-rtdb.firebaseio.com",
  projectId: "adicionales-3d645",
  storageBucket: "adicionales-3d645.firebasestorage.app",
  messagingSenderId: "1072268348737",
  appId: "1:1072268348737:web:f6dbc542496a24a8d7a5c0"
};
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    // ================== UTILIDADES ==================
    const q = (sel) => document.querySelector(sel);
    const el = (tag, cls) => { const n = document.createElement(tag); if (cls) n.className = cls; return n; };
    const nowYear = new Date().getFullYear();
    q('#year').textContent = nowYear;
    
    // Credenciales de administrador (CORREGIDO)
    const adminUser = "admin";
    const adminPass = "admin123";

    function authIsOn() { return localStorage.getItem("auth_admin") === "1"; }
    function authSet(on) { localStorage.setItem("auth_admin", on ? "1" : "0"); }
    
    function requireAuth() {
      if (authIsOn()) {
        q("#loginBox").classList.add("d-none");
        q("#adminContent").classList.remove("d-none");
      } else {
        q("#loginBox").classList.remove("d-none");
        q("#adminContent").classList.add("d-none");
      }
    }

    // Función para mostrar notificaciones toast
    function showToast(message, type = "success") {
      const toast = new bootstrap.Toast(q('#liveToast'));
      q('#toastMessage').textContent = message;
      q('#liveToast').className = `toast align-items-center text-white border-0 bg-${type}`;
      toast.show();
    }

    // Función para mostrar estado de carga
    function setLoadingState(loading) {
      if (loading) {
        document.body.classList.add('loading');
      } else {
        document.body.classList.remove('loading');
      }
    }

    // ================== CARGA PÚBLICO ==================
    async function loadPersonal() {
      try {
        const snap = await db.ref("personal").get();
        const data = snap.val() || {};
        q("#avatarImg").src = data.foto || q("#avatarImg").src;
        q("#nombre").textContent = data.nombre || "Tu Nombre";
        q("#titulo").textContent = data.titulo || "Tu Título Profesional";
        q("#descripcion").textContent = data.descripcion || "Breve descripción profesional.";
        q("#sobreMiText").textContent = data.descripcion || "Aquí puedes ampliar tu historia.";
        q("#emailText").textContent = data.email || "correo@ejemplo.com";
        q("#telefonoText").textContent = data.telefono || "+57 300 000 0000";
        q("#ubicacionText").textContent = data.ubicacion || "Colombia";
        q("#emailLink").href = "mailto:" + (data.email || "correo@ejemplo.com");
        q("#linkedinLink").href = data.linkedin || "#";
        q("#githubLink").href = data.github || "#";
        q("#twitterLink").href = data.twitter || "#";
        q("#cvLink").href = data.cv || "#";

        // precargar admin inputs
        q("#inpFoto").value = data.foto || "";
        q("#inpNombre").value = data.nombre || "";
        q("#inpTitulo").value = data.titulo || "";
        q("#inpDesc").value = data.descripcion || "";
        q("#inpEmail").value = data.email || "";
        q("#inpTel").value = data.telefono || "";
        q("#inpUbic").value = data.ubicacion || "";
        q("#inpLinkedin").value = data.linkedin || "";
        q("#inpGithub").value = data.github || "";
        q("#inpTwitter").value = data.twitter || "";
        q("#inpCv").value = data.cv || "";
      } catch (error) {
        console.error("Error loading personal data:", error);
        showToast("Error al cargar datos personales", "danger");
      }
    }

    function renderHabRow(id, h) {
      const tr = el("tr");
      tr.innerHTML = `<td>${h.nombre}</td>
        <td>${h.tipo === "tech" ? "Técnica" : "Profesional"}</td>
        <td>${h.nivel ?? 0}</td>
        <td class="text-end">
          <button class="btn btn-sm btn-outline-light" data-id="${id}" data-role="del-hab"><i class="bi bi-trash"></i></button>
        </td>`;
      return tr;
    }
    
    function renderHabBadge(h) {
      const span = el("span", "badge badge-soft px-3 py-2");
      span.textContent = h.nombre + (h.nivel ? ` (${h.nivel}%)` : "");
      return span;
    }

    async function loadHabilidades() {
      try {
        const snap = await db.ref("habilidades").get();
        const data = snap.val() || {};
        const tech = Object.entries(data).filter(([id,h]) => h.tipo === "tech").map(([id,h]) => ({id, ...h}));
        const soft = Object.entries(data).filter(([id,h]) => h.tipo !== "tech").map(([id,h]) => ({id, ...h}));

        // público
        const listTech = q("#listTech"); listTech.innerHTML = "";
        tech.forEach(h => listTech.appendChild(renderHabBadge(h)));
        const listSoft = q("#listSoft"); listSoft.innerHTML = "";
        soft.forEach(h => listSoft.appendChild(renderHabBadge(h)));

        // admin tabla
        const tbody = q("#tableHabs"); tbody.innerHTML = "";
        Object.entries(data).forEach(([id, h]) => tbody.appendChild(renderHabRow(id, h)));
      } catch (error) {
        console.error("Error loading skills:", error);
        showToast("Error al cargar habilidades", "danger");
      }
    }

    function expCard(e) {
      const col = el("div", "col-md-6");
      col.innerHTML = `
        <div class="card p-4 h-100">
          <div class="d-flex justify-content-between align-items-start mb-1">
            <h5 class="mb-0">${e.puesto}</h5>
            <span class="badge badge-soft">${e.fechaIni || ""} - ${e.fechaFin || ""}</span>
          </div>
          <div class="muted mb-2">${e.empresa}</div>
          <p class="mb-0">${e.descripcion || ""}</p>
        </div>`;
      return col;
    }
    
    async function loadExperiencia() {
      try {
        const snap = await db.ref("experiencias").get();
        const data = snap.val() || {};
        const cont = q("#experienciaList"); cont.innerHTML = "";
        Object.entries(data).reverse().forEach(([id, e]) => cont.appendChild(expCard(e)));

        // admin tabla
        const tbody = q("#tableExp"); tbody.innerHTML = "";
        Object.entries(data).forEach(([id, e]) => {
          const tr = el("tr");
          tr.innerHTML = `<td>${e.empresa}</td><td>${e.puesto}</td><td>${e.fechaIni || ""} - ${e.fechaFin || ""}</td>
            <td class="text-end"><button class="btn btn-sm btn-outline-light" data-id="${id}" data-role="del-exp"><i class="bi bi-trash"></i></button></td>`;
          tbody.appendChild(tr);
        });
      } catch (error) {
        console.error("Error loading experience:", error);
        showToast("Error al cargar experiencias", "danger");
      }
    }

    function eduCard(e) {
      const col = el("div", "col-md-6");
      col.innerHTML = `
        <div class="card p-4 h-100">
          <h5 class="mb-1">${e.titulo}</h5>
          <div class="muted mb-2">${e.institucion}</div>
          <div class="small">${e.fecha}</div>
        </div>`;
      return col;
    }
    
    async function loadEducacion() {
      try {
        const snap = await db.ref("educacion").get();
        const data = snap.val() || {};
        const cont = q("#educacionList"); cont.innerHTML = "";
        Object.entries(data).reverse().forEach(([id, e]) => cont.appendChild(eduCard(e)));

        const tbody = q("#tableEdu"); tbody.innerHTML = "";
        Object.entries(data).forEach(([id, e]) => {
          const tr = el("tr");
          tr.innerHTML = `<td>${e.institucion}</td><td>${e.titulo}</td><td>${e.fecha}</td>
            <td class="text-end"><button class="btn btn-sm btn-outline-light" data-id="${id}" data-role="del-edu"><i class="bi bi-trash"></i></button></td>`;
          tbody.appendChild(tr);
        });
      } catch (error) {
        console.error("Error loading education:", error);
        showToast("Error al cargar educación", "danger");
      }
    }

    function certCard(c) {
      const col = el("div", "col-md-4");
      col.innerHTML = `
        <div class="card p-3 h-100">
          <img src="${c.imagen || ''}" class="img-fluid rounded mb-2" alt="cert">
          <h6 class="mb-0">${c.nombre}</h6>
          <div class="muted">${c.institucion}</div>
          <div class="small">${c.fecha}</div>
        </div>`;
      return col;
    }
    
    async function loadCertificados() {
      try {
        const snap = await db.ref("certificados").get();
        const data = snap.val() || {};
        const cont = q("#certificadosList"); cont.innerHTML = "";
        Object.entries(data).reverse().forEach(([id, c]) => cont.appendChild(certCard(c)));

        const tbody = q("#tableCert"); tbody.innerHTML = "";
        Object.entries(data).forEach(([id, c]) => {
          const tr = el("tr");
          tr.innerHTML = `<td>${c.nombre}</td><td>${c.institucion}</td><td>${c.fecha}</td>
            <td class="text-end"><button class="btn btn-sm btn-outline-light" data-id="${id}" data-role="del-cert"><i class="bi bi-trash"></i></button></td>`;
          tbody.appendChild(tr);
        });
      } catch (error) {
        console.error("Error loading certificates:", error);
        showToast("Error al cargar certificados", "danger");
      }
    }

    async function loadAll() {
      setLoadingState(true);
      try {
        await Promise.all([
          loadPersonal(), 
          loadHabilidades(), 
          loadExperiencia(), 
          loadEducacion(), 
          loadCertificados()
        ]);
        showToast("Datos cargados correctamente");
      } catch (error) {
        console.error("Error loading all data:", error);
        showToast("Error al cargar datos", "danger");
      } finally {
        setLoadingState(false);
      }
    }

    // ================== ADMIN: EVENTOS ==================
    document.addEventListener("click", async (ev) => {
      const btn = ev.target.closest("button");
      if (!btn) return;
      const role = btn.dataset.role;

      // Habilidades: borrar
      if (role === "del-hab") {
        if (!confirm("¿Estás seguro de eliminar esta habilidad?")) return;
        const id = btn.dataset.id;
        await db.ref("habilidades/" + id).remove();
        loadHabilidades();
        showToast("Habilidad eliminada");
      }
      // Experiencia: borrar
      if (role === "del-exp") {
        if (!confirm("¿Estás seguro de eliminar esta experiencia?")) return;
        const id = btn.dataset.id;
        await db.ref("experiencias/" + id).remove();
        loadExperiencia();
        showToast("Experiencia eliminada");
      }
      // Educación: borrar
      if (role === "del-edu") {
        if (!confirm("¿Estás seguro de eliminar esta formación?")) return;
        const id = btn.dataset.id;
        await db.ref("educacion/" + id).remove();
        loadEducacion();
        showToast("Formación eliminada");
      }
      // Certificado: borrar
      if (role === "del-cert") {
        if (!confirm("¿Estás seguro de eliminar este certificado?")) return;
        const id = btn.dataset.id;
        await db.ref("certificados/" + id).remove();
        loadCertificados();
        showToast("Certificado eliminado");
      }
    });

    // Login (CORREGIDO)
    q("#btnLogin").addEventListener("click", () => {
      const u = q("#loginUser").value.trim();
      const p = q("#loginPass").value.trim();
      
      // Validación simple de credenciales
      if (u === adminUser && p === adminPass) {
        authSet(true); 
        requireAuth();
        showToast("Sesión iniciada correctamente");
      } else {
        showToast("Credenciales inválidas", "danger");
      }
    });
    
    q("#btnLogout").addEventListener("click", () => { 
      authSet(false); 
      requireAuth(); 
      showToast("Sesión cerrada");
    });

    // Guardar personal
    q("#btnSavePersonal").addEventListener("click", async () => {
      setLoadingState(true);
      try {
        const payload = {
          foto: q("#inpFoto").value.trim(),
          nombre: q("#inpNombre").value.trim(),
          titulo: q("#inpTitulo").value.trim(),
          descripcion: q("#inpDesc").value.trim(),
          email: q("#inpEmail").value.trim(),
          telefono: q("#inpTel").value.trim(),
          ubicacion: q("#inpUbic").value.trim(),
          linkedin: q("#inpLinkedin").value.trim(),
          github: q("#inpGithub").value.trim(),
          twitter: q("#inpTwitter").value.trim(),
          cv: q("#inpCv").value.trim()
        };
        await db.ref("personal").set(payload);
        await loadPersonal();
        showToast("Información personal guardada");
      } catch (error) {
        console.error("Error saving personal data:", error);
        showToast("Error al guardar información personal", "danger");
      } finally {
        setLoadingState(false);
      }
    });
    
    // Previsualizar personal (sin guardar)
    q("#btnPreviewPersonal").addEventListener("click", () => {
      q("#avatarImg").src = q("#inpFoto").value.trim() || q("#avatarImg").src;
      q("#nombre").textContent = q("#inpNombre").value.trim() || "Tu Nombre";
      q("#titulo").textContent = q("#inpTitulo").value.trim() || "Tu Título Profesional";
      q("#descripcion").textContent = q("#inpDesc").value.trim() || "Breve descripción profesional.";
      q("#sobreMiText").textContent = q("#inpDesc").value.trim() || "Aquí puedes ampliar tu historia.";
      q("#emailText").textContent = q("#inpEmail").value.trim() || "correo@ejemplo.com";
      q("#telefonoText").textContent = q("#inpTel").value.trim() || "+57 300 000 0000";
      q("#ubicacionText").textContent = q("#inpUbic").value.trim() || "Colombia";
      q("#emailLink").href = "mailto:" + (q("#inpEmail").value.trim() || "correo@ejemplo.com");
      q("#linkedinLink").href = q("#inpLinkedin").value.trim() || "#";
      q("#githubLink").href = q("#inpGithub").value.trim() || "#";
      q("#twitterLink").href = q("#inpTwitter").value.trim() || "#";
      q("#cvLink").href = q("#inpCv").value.trim() || "#";
      showToast("Vista previa actualizada");
    });

    // Agregar habilidad
    q("#btnAddHab").addEventListener("click", async () => {
      const nombre = q("#inpHabNombre").value.trim();
      const tipo = q("#inpHabTipo").value;
      const nivel = Number(q("#inpHabNivel").value || 0);
      if (!nombre) return showToast("Ingresa un nombre de habilidad", "warning");

      try {
        const ref = db.ref("habilidades").push();
        await ref.set({ nombre, tipo, nivel });
        q("#inpHabNombre").value = ""; 
        q("#inpHabNivel").value = "70"; 
        q("#inpHabTipo").value = "tech";
        loadHabilidades();
        showToast("Habilidad agregada");
      } catch (error) {
        console.error("Error adding skill:", error);
        showToast("Error al agregar habilidad", "danger");
      }
    });

    // Agregar experiencia
    q("#btnAddExp").addEventListener("click", async () => {
      const empresa = q("#inpExpEmpresa").value.trim();
      const puesto = q("#inpExpPuesto").value.trim();
      const fechaIni = q("#inpExpIni").value.trim();
      const fechaFin = q("#inpExpFin").value.trim();
      const descripcion = q("#inpExpDesc").value.trim();
      if (!empresa || !puesto) return showToast("Empresa y Puesto son obligatorios", "warning");
      
      try {
        const ref = db.ref("experiencias").push();
        await ref.set({ empresa, puesto, fechaIni, fechaFin, descripcion });
        q("#inpExpEmpresa").value = ""; 
        q("#inpExpPuesto").value = "";
        q("#inpExpIni").value = ""; 
        q("#inpExpFin").value = ""; 
        q("#inpExpDesc").value = "";
        loadExperiencia();
        showToast("Experiencia agregada");
      } catch (error) {
        console.error("Error adding experience:", error);
        showToast("Error al agregar experiencia", "danger");
      }
    });

    // Agregar educación
    q("#btnAddEdu").addEventListener("click", async () => {
      const institucion = q("#inpEduInst").value.trim();
      const titulo = q("#inpEduTitulo").value.trim();
      const fecha = q("#inpEduFecha").value.trim();
      if (!institucion || !titulo) return showToast("Institución y Título son obligatorios", "warning");
      
      try {
        const ref = db.ref("educacion").push();
        await ref.set({ institucion, titulo, fecha });
        q("#inpEduInst").value = ""; 
        q("#inpEduTitulo").value = ""; 
        q("#inpEduFecha").value = "";
        loadEducacion();
        showToast("Formación agregada");
      } catch (error) {
        console.error("Error adding education:", error);
        showToast("Error al agregar formación", "danger");
      }
    });

    // Previsualizar certificado (sin guardar)
    q("#btnPreviewCert").addEventListener("click", () => {
      const nombre = q("#inpCertNombre").value.trim();
      const inst = q("#inpCertInst").value.trim();
      const fecha = q("#inpCertFecha").value.trim();
      const img = q("#inpCertImg").value.trim();
      q("#certPrevNombre").textContent = nombre || "Nombre del certificado";
      q("#certPrevInst").textContent = inst || "Institución";
      q("#certPrevFecha").textContent = fecha || "Fecha";
      q("#certPrevImg").src = img || "https://via.placeholder.com/400x250?text=Certificado";
      q("#certPreview").classList.remove("d-none");
      showToast("Vista previa del certificado");
    });
    
    // Agregar certificado
    q("#btnAddCert").addEventListener("click", async () => {
      const nombre = q("#inpCertNombre").value.trim();
      const institucion = q("#inpCertInst").value.trim();
      const fecha = q("#inpCertFecha").value.trim();
      const imagen = q("#inpCertImg").value.trim();
      if (!nombre || !institucion) return showToast("Nombre e Institución son obligatorios", "warning");
      
      try {
        const ref = db.ref("certificados").push();
        await ref.set({ nombre, institucion, fecha, imagen });
        q("#inpCertNombre").value = ""; 
        q("#inpCertInst").value = ""; 
        q("#inpCertFecha").value = ""; 
        q("#inpCertImg").value = "";
        q("#certPreview").classList.add("d-none");
        loadCertificados();
        showToast("Certificado agregado");
      } catch (error) {
        console.error("Error adding certificate:", error);
        showToast("Error al agregar certificado", "danger");
      }
    });

    // Inicial
    requireAuth();
    loadAll();
  </script>
</body>
</html>
